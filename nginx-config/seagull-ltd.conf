# Main HTTPS server (uncomment after SSL is installed)
# server {
#     listen 443 ssl http2;
#     server_name seagull-ltd.com www.seagull-ltd.com;
# 
#     # SSL-START SSL configuration
#     ssl_certificate /path/to/fullchain.pem;  # Update this path after SSL installation
#     ssl_certificate_key /path/to/privkey.pem;  # Update this path after SSL installation
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
#     ssl_prefer_server_ciphers on;
#     ssl_session_tickets on;
#     ssl_session_cache shared:SSL:10m;
#     ssl_session_timeout 10m;
#     add_header Strict-Transport-Security "max-age=31536000" always;
#     # SSL-END
# 
#     # Error pages
#     error_page 404 /404.html;
#     error_page 502 /502.html;
# 
#     # Next.js application proxy
#     location / {
#         proxy_pass http://127.0.0.1:3000;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection 'upgrade';
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_cache_bypass $http_upgrade;
#         proxy_read_timeout 86400;
#         
#         # NUCLEAR cache-busting for HTML pages
#         add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
#         add_header Pragma "no-cache";
#         add_header Expires "0";
#         add_header X-Accel-Expires "0";
#         proxy_no_cache 1;
#         proxy_cache_bypass 1;
#     }
# 
#     # Static assets optimization (_next/static)
#     location /_next/static/ {
#         proxy_pass http://127.0.0.1:3000;
#         add_header Cache-Control "no-cache, no-store, must-revalidate";
#         add_header Pragma "no-cache";
#         add_header Expires "0";
#     }
# 
#     # API routes (if you add them later)
#     location /api/ {
#         proxy_pass http://127.0.0.1:3000;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection 'upgrade';
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_cache_bypass $http_upgrade;
#     }
# 
#     # Forbidden files or directories for Next.js
#     location ~ ^/(\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README.md|\.next|node_modules) {
#         return 404;
#     }
# 
#     # Directory verification for SSL certificate
#     location ~ \.well-known {
#         allow all;
#     }
# 
#     # Prohibit sensitive files in certificate verification directory
#     if ( $uri ~ "^/\.well-known/.*\.(php|jsp|py|js|css|lua|ts|go|zip|tar\.gz|rar|7z|sql|bak)$" ) {
#         return 403;
#     }
# 
#     # Optimized static file serving for Next.js assets
#     location ~* \.(ico|css|js|gif|jpe?g|png|svg|woff|woff2|ttf|eot|pdf)$ {
#         proxy_pass http://127.0.0.1:3000;
#         add_header Cache-Control "no-cache, no-store, must-revalidate";
#         add_header Pragma "no-cache";
#         add_header Expires "0";
#         access_log off;
#     }
# 
#     # Client body size
#     client_max_body_size 50M;
# 
    # Logs (aaPanel/BT Panel log locations)
    access_log /www/wwwlogs/seagull-ltd.com.log;
    error_log /www/wwwlogs/seagull-ltd.com.error.log;
# }

# HTTP server (current active configuration)
server {
    listen 80;
    server_name seagull-ltd.com www.seagull-ltd.com;
    
    # Redirect to HTTPS (uncomment after SSL is installed)
    # return 301 https://seagull-ltd.com$request_uri;

    # Next.js application proxy
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 86400;
        
        # NUCLEAR cache-busting for HTML pages
        add_header Cache-Control "no-cache, no-store, must-revalidate, max-age=0";
        add_header Pragma "no-cache";
        add_header Expires "0";
        add_header X-Accel-Expires "0";
        proxy_no_cache 1;
        proxy_cache_bypass 1;
    }

    # Static assets optimization (_next/static)
    location /_next/static/ {
        proxy_pass http://127.0.0.1:3000;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }

    # API routes (if you add them later)
    location /api/ {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Forbidden files or directories for Next.js
    location ~ ^/(\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README.md|\.next|node_modules) {
        return 404;
    }

    # Directory verification for SSL certificate
    location ~ \.well-known {
        allow all;
    }

    # Prohibit sensitive files in certificate verification directory
    if ( $uri ~ "^/\.well-known/.*\.(php|jsp|py|js|css|lua|ts|go|zip|tar\.gz|rar|7z|sql|bak)$" ) {
        return 403;
    }

    # Optimized static file serving for Next.js assets
    location ~* \.(ico|css|js|gif|jpe?g|png|svg|woff|woff2|ttf|eot|pdf)$ {
        proxy_pass http://127.0.0.1:3000;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
        access_log off;
    }

    # Client body size
    client_max_body_size 50M;

    # Logs (aaPanel/BT Panel log locations)
    access_log /www/wwwlogs/seagull-ltd.com.log;
    error_log /www/wwwlogs/seagull-ltd.com.error.log;
}
